% =================================================
% Document class
% =================================================
% NOTE:
% - Do NOT pass $papersize$ as a class option. Pandoc/geometry handle it.
% - Keep it simple and deterministic.
\documentclass[
  $fontsize$
]{report}

% =================================================
% Core packages
% =================================================
\usepackage{graphicx}
\usepackage{geometry}
\usepackage{setspace}
\usepackage{hyperref}
\usepackage{bookmark}
\usepackage{tocloft}
\usepackage{fancyhdr}
\usepackage{emptypage}
\usepackage{calc}
\usepackage{eso-pic}

% =================================================
% Page geometry & line spacing
% =================================================
\geometry{
  margin=25mm
}
\setstretch{$linestretch$}

% =================================================
% Global image sizing (content images)
% =================================================
\setkeys{Gin}{width=0.85\linewidth, keepaspectratio}

% =================================================
% Hyperlink appearance
% =================================================
\hypersetup{hidelinks}

% =================================================
% Pandoc tables support
% =================================================
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{array}

% =================================================
% Subtitle support (robust)
% =================================================
% IMPORTANT:
% - Initialise \@subtitle to empty.
% - Only print subtitle if non-empty.
\makeatletter
\providecommand{\subtitle}[1]{\gdef\@subtitle{#1}}
\providecommand{\@subtitle}{} % safe default

\renewcommand{\maketitle}{%
  \begin{titlepage}
    \centering
    {\huge\bfseries \@title \par}
    \vspace{1em}
    \ifx\@subtitle\@empty\else
      {\Large \@subtitle \par}
      \vspace{2em}
    \fi
    \ifx\@author\@empty\else
      {\large \@author \par}
    \fi
    \vfill
    \ifx\@date\@empty\else
      {\large \@date \par}
    \fi
  \end{titlepage}
}
\makeatother

% =================================================
% Draft watermark (optional)
% =================================================
$if(draft)$
\usepackage{draftwatermark}
\SetWatermarkText{DRAFT}
\SetWatermarkScale{1}
\SetWatermarkColor[gray]{0.9}
$endif$

% =================================================
% Header / footer configuration
% =================================================
\pagestyle{fancy}
\fancyhf{}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0pt}

% =================================================
% Pandoc compatibility: tight lists
% =================================================
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}%
  \setlength{\parskip}{0pt}%
}

% =================================================
% Pandoc compatibility: code blocks + highlighting
% =================================================
\usepackage{color}
\usepackage{framed}
\usepackage{fancyvrb}

\definecolor{shadecolor}{RGB}{245,245,245}

\newenvironment{Shaded}{%
  \begin{snugshade}%
}{%
  \end{snugshade}%
}

\DefineVerbatimEnvironment{Highlighting}{Verbatim}{%
  commandchars=\\\{\}%
}

% Pandoc syntax highlighting token definitions
\newcommand{\AlertTok}[1]{\textcolor{red}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor{gray}{#1}}
\newcommand{\AttributeTok}[1]{#1}
\newcommand{\BaseNTok}[1]{#1}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor{gray}{#1}}
\newcommand{\ConstantTok}[1]{#1}
\newcommand{\ControlFlowTok}[1]{#1}
\newcommand{\DataTypeTok}[1]{#1}
\newcommand{\DecValTok}[1]{#1}
\newcommand{\DocumentationTok}[1]{#1}
\newcommand{\ErrorTok}[1]{\textcolor{red}{#1}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{#1}
\newcommand{\FunctionTok}[1]{#1}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{#1}
\newcommand{\KeywordTok}[1]{\textbf{#1}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{#1}
\newcommand{\OtherTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{#1}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{#1}
\newcommand{\SpecialStringTok}[1]{#1}
\newcommand{\StringTok}[1]{#1}
\newcommand{\VariableTok}[1]{#1}
\newcommand{\VerbatimStringTok}[1]{#1}
\newcommand{\WarningTok}[1]{\textcolor{red}{#1}}

% =================================================
% Pandoc compatibility: allow 'none' as counter value
% =================================================
\makeatletter
\@ifundefined{c@none}{\newcounter{none}}{}
\makeatother

% =================================================
% Pandoc >= 3.x compatibility
% =================================================
\providecommand{\pandocbounded}[1]{#1}

% =================================================
% Matter controls (report does NOT provide these)
% =================================================
\makeatletter
\newcommand{\frontmatter}{%
  \cleardoublepage%
  \pagenumbering{roman}%
  \setcounter{chapter}{0}%
  \setcounter{section}{0}%
  \setcounter{subsection}{0}%
}
\newcommand{\mainmatter}{%
  \cleardoublepage%
  \pagenumbering{arabic}%
  \setcounter{chapter}{0}%
  \setcounter{section}{0}%
  \setcounter{subsection}{0}%
}
\newcommand{\backmatter}{%
  \cleardoublepage%
}
\makeatother

% =================================================
% Heading + numbering model
% =================================================
\setcounter{secnumdepth}{2}
\setcounter{tocdepth}{2}

\renewcommand{\thechapter}{\arabic{chapter}}
\renewcommand{\thesection}{\thechapter.\arabic{section}}
\renewcommand{\thesubsection}{\thechapter.\arabic{subsection}}

% =================================================
% Make "Chapter" not print as the word "Chapter"
% =================================================
\renewcommand{\chaptername}{}
\makeatletter
\def\@makechapterhead#1{%
  \vspace*{20pt}%
  {\parindent 0pt \raggedright
    \normalfont\huge\bfseries
    \ifnum \c@chapter>0
      \thechapter\quad
    \fi
    #1\par\nobreak
    \vspace{12pt}%
  }%
}
\def\@makeschapterhead#1{%
  \vspace*{20pt}%
  {\parindent 0pt \raggedright
    \normalfont\huge\bfseries
    #1\par\nobreak
    \vspace{12pt}%
  }%
}
\makeatother

% =================================================
% Make top-level "SECTION I ..." headings bigger/bolder than chapters
% =================================================
\makeatletter
\renewcommand\section{\@startsection{section}{1}{\z@}%
  {-3.5ex \@plus -1ex \@minus -.2ex}%
  {2.3ex \@plus .2ex}%
  {\normalfont\Huge\bfseries}}
\renewcommand\subsection{\@startsection{subsection}{2}{\z@}%
  {-3.25ex\@plus -1ex \@minus -.2ex}%
  {1.5ex \@plus .2ex}%
  {\normalfont\Large\bfseries}}
\makeatother

% =================================================
% TOC styling
% =================================================
\renewcommand{\cfttoctitlefont}{\Huge\bfseries}
\renewcommand{\cftaftertoctitle}{\hfill}

\renewcommand{\cftchapfont}{\bfseries}
\renewcommand{\cftchappagefont}{\bfseries}
\setlength{\cftchapindent}{0pt}
\setlength{\cftchapnumwidth}{2.5em}

\renewcommand{\cftsecfont}{\Large\bfseries}
\renewcommand{\cftsecpagefont}{\Large\bfseries}
\setlength{\cftsecindent}{0pt}
\setlength{\cftsecnumwidth}{3.0em}

\renewcommand{\cftsubsecfont}{\normalfont}
\renewcommand{\cftsubsecpagefont}{\normalfont}
\setlength{\cftsubsecindent}{0pt}
\setlength{\cftsubsecnumwidth}{3.0em}

% =================================================
% Document starts here
% =================================================
\begin{document}

% Covers and title pages should not carry headers/footers or numbers
\pagestyle{empty}
\pagenumbering{gobble}

% -------------------------------------------------
% Front cover (full-bleed)
% -------------------------------------------------
% -------------------------------------------------
% Front cover (centred, aspect-safe)
% -------------------------------------------------
$if(cover_front)$
\clearpage
\thispagestyle{empty}
\AddToShipoutPictureBG*{%
  \AtPageCenter{%
    \makebox(0,0){%
      \includegraphics[
        width=\paperwidth,
        height=\paperheight,
        keepaspectratio
      ]{$cover_front$}%
    }%
  }%
}
\mbox{}
\clearpage
\ClearShipoutPictureBG
$endif$


% -------------------------------------------------
% Title page
% -------------------------------------------------
$if(title)$
\title{$title$}
$if(subtitle)$
\subtitle{$subtitle$}
$endif$
$if(author)$
\author{$author$}
$endif$
$if(date)$
\date{$date$}
$endif$
\maketitle
\clearpage
$endif$

% -------------------------------------------------
% Copyright page
% -------------------------------------------------
$if(copyright)$
\thispagestyle{empty}
\vspace*{\fill}
\begin{center}
$copyright$
\end{center}
\vspace*{\fill}
\clearpage
$endif$

% -------------------------------------------------
% Body
% -------------------------------------------------
% Expect \frontmatter / \tableofcontents / \mainmatter
% to be injected via your control/section files.
$body$

% -------------------------------------------------
% Back cover (full-bleed)
% -------------------------------------------------
% -------------------------------------------------
% Back cover (full-bleed, isolated)
% -------------------------------------------------
% -------------------------------------------------
% Back cover (centred, aspect-safe)
% -------------------------------------------------
$if(cover_back)$
\clearpage
\thispagestyle{empty}
\AddToShipoutPictureBG*{%
  \AtPageCenter{%
    \makebox(0,0){%
      \includegraphics[
        width=\paperwidth,
        height=\paperheight,
        keepaspectratio
      ]{$cover_back$}%
    }%
  }%
}
\mbox{}
\clearpage
\ClearShipoutPictureBG
$endif$



\end{document}
