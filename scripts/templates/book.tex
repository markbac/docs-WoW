% =================================================
% Document class
% =================================================
%
% openany   -> chapters/parts can start on any page (PDF / draft)
% openright -> chapters/parts start on right-hand pages (PRINT)
%
% Switch THIS ONE LINE when preparing a printed book.
%
\documentclass[
  $fontsize$,
  $papersize$,
  openany
]{book}

% =================================================
% PART BEHAVIOUR OVERRIDE
% =================================================
% Keep parts visually clean but predictable.
% Uses cleardoublepage so print layouts still behave correctly.
%
\makeatletter
\renewcommand\part{\cleardoublepage
  \thispagestyle{plain}
  \secdef\@part\@spart}
\makeatother


% =================================================
% Core packages
% =================================================
\usepackage{graphicx}
\usepackage{geometry}
\usepackage{setspace}
\usepackage{hyperref}
\usepackage{bookmark}
\usepackage{tocloft}
\usepackage{fancyhdr}
\usepackage{emptypage}
\usepackage{calc}

% =================================================
% Global image sizing
% =================================================
\setkeys{Gin}{width=0.85\linewidth, keepaspectratio}

% =================================================
% Hyperlink appearance
% =================================================
\hypersetup{
  hidelinks
}

% =================================================
% Pandoc tables support
% =================================================
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{array}

% =================================================
% Subtitle support
% =================================================
\makeatletter
\newcommand{\subtitle}[1]{\gdef\@subtitle{#1}}
\newcommand{\@subtitle}{}
\renewcommand{\maketitle}{%
  \begin{titlepage}
    \centering
    {\huge\bfseries \@title \par}
    \vspace{1em}
    {\Large \@subtitle \par}
    \vspace{2em}
    {\large \@author \par}
    \vfill
    {\large \@date \par}
  \end{titlepage}
}
\makeatother

% =================================================
% Pandoc compatibility: allow 'none' as counter value
% =================================================
\makeatletter
\@ifundefined{c@none}{\newcounter{none}}{}
\makeatother

% =================================================
% Draft watermark (optional, metadata-driven)
% =================================================
$if(draft)$
\usepackage{draftwatermark}
\SetWatermarkText{DRAFT}
\SetWatermarkScale{1}
\SetWatermarkColor[gray]{0.9}
$endif$

% =================================================
% Page geometry & line spacing
% =================================================
\geometry{margin=25mm}
\setstretch{$linestretch$}

% =================================================
% Header / footer configuration
% =================================================
\pagestyle{fancy}
\fancyhf{}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0pt}

% =================================================
% Pandoc compatibility: tight lists
% =================================================
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}%
  \setlength{\parskip}{0pt}%
}

% =================================================
% Pandoc compatibility: code blocks
% =================================================
\usepackage{color}
\usepackage{framed}
\usepackage{fancyvrb}

\definecolor{shadecolor}{RGB}{245,245,245}

\newenvironment{Shaded}{%
  \begin{snugshade}%
}{%
  \end{snugshade}%
}

% =================================================
% Pandoc code highlighting environment
% =================================================
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{%
  commandchars=\\\{\}
}

% =================================================
% Pandoc syntax highlighting token definitions
% =================================================
\newcommand{\AlertTok}[1]{\textcolor{red}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor{gray}{#1}}
\newcommand{\AttributeTok}[1]{#1}
\newcommand{\BaseNTok}[1]{#1}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor{gray}{#1}}
\newcommand{\ConstantTok}[1]{#1}
\newcommand{\ControlFlowTok}[1]{#1}
\newcommand{\DataTypeTok}[1]{#1}
\newcommand{\DecValTok}[1]{#1}
\newcommand{\DocumentationTok}[1]{#1}
\newcommand{\ErrorTok}[1]{\textcolor{red}{#1}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{#1}
\newcommand{\FunctionTok}[1]{#1}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{#1}
\newcommand{\KeywordTok}[1]{\textbf{#1}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{#1}
\newcommand{\OtherTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{#1}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{#1}
\newcommand{\SpecialStringTok}[1]{#1}
\newcommand{\StringTok}[1]{#1}
\newcommand{\VariableTok}[1]{#1}
\newcommand{\VerbatimStringTok}[1]{#1}
\newcommand{\WarningTok}[1]{\textcolor{red}{#1}}

% =================================================
% Pandoc compatibility (Pandoc >= 3.x)
% =================================================
\providecommand{\pandocbounded}[1]{#1}

% =================================================
% Document starts here
% =================================================
\begin{document}

% -------------------------------------------------
% Title page
% -------------------------------------------------
$if(title)$
\title{$title$}
$if(subtitle)$
\subtitle{$subtitle$}
$endif$
$if(author)$
\author{$author$}
$endif$
$if(date)$
\date{$date$}
$endif$
\maketitle
\clearpage
$endif$

% -------------------------------------------------
% Copyright page
% -------------------------------------------------
$if(copyright)$
\thispagestyle{empty}
\vspace*{\fill}
\begin{center}
$copyright$
\end{center}
\vspace*{\fill}
\clearpage
$endif$

% =================================================
% FRONT MATTER
% =================================================
%
% Roman numerals
% Preface, Acknowledgements, etc.
%
\frontmatter

$body$

% =================================================
% TABLE OF CONTENTS
% =================================================
%
% Convention:
% - Comes AFTER front matter
% - Does NOT list itself
%
\cleardoublepage
\tableofcontents
\cleardoublepage

% =================================================
% MAIN MATTER
% =================================================
%
% Arabic numerals start here
% Introduction and all chapters follow
%
\mainmatter

\end{document}
